<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake</title>
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 50% 20%, #0f172a, var(--bg));
      color: var(--text);
      display: grid;
      place-items: center;
      min-height: 100vh;
      padding: 16px;
    }
    .wrap {
      width: min(1100px, 100%);
      display: grid;
      gap: 12px;
    }
    header {
      display: flex;
      justify-content: space-between;
      padding: 12px 14px;
      background: rgba(17,24,39,.75);
      border-radius: 14px;
    }
    .stats { display: flex; gap: 12px; color: var(--muted); }
    .stats b { color: var(--text); }

    .content {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 12px;
    }
    @media (max-width: 900px) {
      .content { grid-template-columns: 1fr; }
    }

    .panel {
      background: rgba(17,24,39,.75);
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 12px;
    }
    canvas {
      width: 100%;
      border-radius: 12px;
      background: #0b1220;
    }

    button, select, input {
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.15);
      color: var(--text);
      padding: 8px 12px;
      border-radius: 10px;
    }

    .lbList { max-height: 520px; overflow-y: auto; }
    .lbRow {
      display: grid;
      grid-template-columns: 40px 1fr 60px;
      padding: 6px 8px;
      font-size: 13px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h2>üêç Classic Snake</h2>
    <div class="stats">
      <div>Score <b id="score">0</b></div>
      <div>Best <b id="best">0</b></div>
      <div>Speed <b id="speedLabel">Normal</b></div>
    </div>
  </header>

  <div class="content">
    <div class="panel">
      <canvas id="game" width="600" height="600"></canvas>

      <div>
        <button id="startBtn">Start</button>
        <button id="pauseBtn">Pause</button>
        <button id="resetBtn">Reset</button>

        <select id="speedSel">
          <option value="10">Slow</option>
          <option value="12" selected>Normal</option>
          <option value="15">Fast</option>
          <option value="18">Insane</option>
        </select>

        <input id="nameInput" placeholder="Player" maxlength="16">
      </div>
    </div>

    <aside class="panel">
      <h3>üèÜ Leaderboard (Top 100)</h3>
      <div class="lbList" id="lbList"></div>
    </aside>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");
  const speedLabelEl = document.getElementById("speedLabel");

  const startBtn = document.getElementById("startBtn");
  const pauseBtn = document.getElementById("pauseBtn");
  const resetBtn = document.getElementById("resetBtn");
  const speedSel = document.getElementById("speedSel");
  const nameInput = document.getElementById("nameInput");
  const lbList = document.getElementById("lbList");

  const GRID = 24;
  const CELL = canvas.width / GRID;

  let snake, dir, nextDir, food;
  let running = false, paused = false, gameOver = false;
  let score = 0, best = 0;
  let tps = Number(speedSel.value);

  const BEST_KEY = "snake_best";
  const LB_KEY = "snake_lb";

  function resetGame() {
    snake = [{x:12,y:12},{x:11,y:12},{x:10,y:12}];
    dir = {x:1,y:0};
    nextDir = {x:1,y:0};
    score = 0;
    scoreEl.textContent = 0;
    gameOver = false;
    running = false;
    paused = false;
    placeFood();
    draw();
  }

  function placeFood() {
    while (true) {
      const x = Math.floor(Math.random()*GRID);
      const y = Math.floor(Math.random()*GRID);
      if (!snake.some(s=>s.x===x && s.y===y)) {
        food = {x,y};
        return;
      }
    }
  }

  function startGame() {
    if (gameOver) resetGame();
    running = true;
    paused = false;
    loop(performance.now());
  }

  function gameOverFn() {
    running = false;
    gameOver = true;

    if (score > best) {
      best = score;
      localStorage.setItem(BEST_KEY, best);
      bestEl.textContent = best;
    }

    if (score > 0) saveScore();
    draw();
  }

  function saveScore() {
    const lb = JSON.parse(localStorage.getItem(LB_KEY) || "[]");
    lb.push({name: nameInput.value || "Player", score, ts: Date.now()});
    lb.sort((a,b)=>b.score-a.score || b.ts-a.ts);
    localStorage.setItem(LB_KEY, JSON.stringify(lb.slice(0,100)));
    renderLB();
  }

  function renderLB() {
    const lb = JSON.parse(localStorage.getItem(LB_KEY) || "[]");
    lbList.innerHTML = lb.map((r,i)=>`
      <div class="lbRow">
        <div>#${i+1}</div>
        <div>${r.name}</div>
        <div>${r.score}</div>
      </div>
    `).join("");
  }

  function tick() {
    if (!running || paused) return;

    dir = nextDir;
    const head = snake[0];
    const nx = head.x + dir.x;
    const ny = head.y + dir.y;

    if (nx<0||nx>=GRID||ny<0||ny>=GRID||snake.some(s=>s.x===nx&&s.y===ny)) {
      gameOverFn();
      return;
    }

    snake.unshift({x:nx,y:ny});
    if (nx===food.x && ny===food.y) {
      score++;
      scoreEl.textContent = score;
      placeFood();
    } else {
      snake.pop();
    }
    draw();
  }

  function draw() {
    ctx.fillStyle="#0b1220";
    ctx.fillRect(0,0,600,600);

    ctx.fillStyle="#ef4444";
    ctx.fillRect(food.x*CELL+4,food.y*CELL+4,CELL-8,CELL-8);

    ctx.fillStyle="#22c55e";
    snake.forEach(s=>{
      ctx.fillRect(s.x*CELL+3,s.y*CELL+3,CELL-6,CELL-6);
    });
  }

  function loop(t) {
    if (!running) return;
    setTimeout(()=>{ tick(); loop(performance.now()); },1000/tps);
  }

  document.addEventListener("keydown", e => {
    if (gameOver) return;

    const k = e.key.toLowerCase();
    const map = {
      arrowup:[0,-1], w:[0,-1],
      arrowdown:[0,1], s:[0,1],
      arrowleft:[-1,0], a:[-1,0],
      arrowright:[1,0], d:[1,0]
    };
    if (map[k]) {
      const [x,y] = map[k];
      if (!(x===-dir.x && y===-dir.y)) {
        nextDir = {x,y};
        if (!running) startGame(); // ‚úÖ START ON ARROW KEY
      }
    }
  });

  startBtn.onclick = startGame;
  resetBtn.onclick = resetGame;
  pauseBtn.onclick = ()=> paused = !paused;

  speedSel.onchange = ()=> {
    tps = Number(speedSel.value);
    speedLabelEl.textContent = speedSel.options[speedSel.selectedIndex].text;
  };

  best = Number(localStorage.getItem(BEST_KEY) || 0);
  bestEl.textContent = best;
  renderLB();
  resetGame();
})();
</script>
</body>
</html>
